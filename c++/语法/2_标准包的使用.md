|目录|
|-|
|[optional](#1-stdoptional)|

# 1 std::optional

**作用**: 用于表达“一个值可能存在，也可能不存在”，且这种“不存在”是类型安全、语义清晰的。

**使用**：

引用包： `#include <optional>`

<font color=green>**判空方式**</font>: 
```c++
if (v.has_value()) {
    // or if (v)
}
```

<font color=green>**取值方式**</font>：
|方式|	特点|
|----|-----|
|*v|	简洁，但需确保有值|
|v.value()|	无值时抛异常|
|v.value_or(0)|	推荐：提供默认值|

**和指针的本质区别**

`int* p = nullptr;`表示“地址是否存在”, 暗示动态内存, 语义不清

`std::optional<int> v;`表示“值是否存在”, 不涉及内存管理, 语义明确
>如果你表达的是“有没有这个值”，而不是“有没有这个对象”，就用 optional。

<font color=green>**延迟初始化**</font>：
```c++
std::optional<Socket> sock;

if (connected) {
    sock.emplace(fd);
}
```

<font color=green>**什么时候不该用 optional**</font>：

|不适合的场景|	原因|
|----|------|
|性能极端敏感|	多一个分支|
|成员几乎总是存在|	多余|
|表示“错误原因”|	用 expected|

<font color=green>**optional 对比 unique_ptr**</font>：

|对比项|	optional|	unique_ptr|
|------|-----------|--------------|
|是否动态分配|	否|	是|
|表达含义|	值存在与否|	所有权|
|适合 POD|	✔|	❌|
|可空语义|	✔|	✔|


**示例**：
```c++
#include <iostream>
#include <optional>

std::optional<int> GetValue(int a) {
    if (a > 10){
        return a;
    }
    return std::nullopt;
}

int main() {
    std::optional<int> v = GetValue(10);
    if (v.has_value()) {
        std::cout << *v << "\n";
    }else {
        std::cout << "not exist" << "\n";
    }
}
```