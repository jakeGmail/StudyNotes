

# 1 更新单个文档

## 1.1 在bson的数组中插入元素

```go
// 获取collection
col := xmongo.Client.Database(config.AppMongoDBName).Collection(config.MongoCollectionVoteInfo)

// 构建查询条件vote_id=request.VoteId && group_id=request.GroupId
filter := bson.M{"vote_id": request.VoteId, "group_id": request.GroupId}

// 后见更新语句，$push表示新增一个元素，vote_records表示在vote_records字段下的数组中新增
update := bson.M{
    "$push": bson.M{
        "vote_records": mongoModule.VoteRecord{
            VoteTime: time.Now().Unix(),
            OptIdx:   request.Selection,
            Voter:    s.UserID(),
        },
    },
}

// 执行
updateResult, err := col.UpdateOne(ctx, filter, update)
if err != nil {
    xlog.Errorf("get vote info failed, err:%v", err)
    return err
}

// 判断是否修改成功
if updateResult.ModifiedCount == 0 {
    xlog.Errorf("upsert vote fail, %v", updateResult.UpsertedCount)
    return errors.New("not update")
}
```