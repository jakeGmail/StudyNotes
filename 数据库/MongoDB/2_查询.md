
## 字段查询

```go
import (
	"go.mongodb.org/mongo-driver/bson"
	"go.mongodb.org/mongo-driver/mongo"
	"go.mongodb.org/mongo-driver/mongo/options"
)

type MomentComments struct {
	MomentID int64     `bson:"moment_id" json:"moment_id"` // 广场动态id
	Comments []Comment `bson:"comments" json:"comments"`   // 评论列表（根评论）
}

type Comment struct {
	CommentID   uint64    `bson:"comment_id" json:"comment_id"`                         // 根评论id
	Content     string    `bson:"content" json:"content"`                               // 评论内容
	Commentator int64     `bson:"commentator" json:"commentator"`                       // 评论者的uid
	NickName    string    `bson:"-" json:"nick_name"`                                   // 名称
	Avatar      string    `bson:"-" json:"avatar"`                                      // 用户头像
	SubComments []Comment `bson:"sub_comments,omitempty" json:"sub_comments,omitempty"` // 子评论（递归）
}


var comment MomentComments
collection := xmongo.Client.Database(config.AppMongoDBName).Collection(config.CommentsDbName)
filter := bson.M{"moment_id": 3} // 查询moment_id=3的document

// 设置对于comments数组字段的元素，只获取20条子数据
projection := bson.M{
    "moment_id": 3,
    "comments":  bson.M{"$slice": 20}, // 正确：投影中使用 $slice
    "_id":       0,
}
opts := options.FindOne().SetProjection(projection)

err = collection.FindOne(ctx, filter, opts).Decode(&comment)
```

## 分页查询

```go
var comment MomentComments
collection := xmongo.Client.Database(config.AppMongoDBName).Collection(config.CommentsDbName)

pipeline := mongo.Pipeline{
    {{"$match", bson.D{{"moment_id", req.MomentId()}}}},
    {{"$project", bson.D{
        {"moment_id", req.MomentId()},
        {"comments", bson.D{{"$slice", bson.A{"$comments", req.Page(), req.Size()}}}},
    }}},
}
cursor, err := collection.Aggregate(ctx, pipeline)
if err != nil {
    return utils.GetErrorRsp(fbs.ErrorCodeUndefineError, err.Error()), nil
}
defer func() { _ = cursor.Close(ctx) }()

for cursor.Next(ctx) {
    if err := cursor.Decode(&comment); err != nil {
        xlog.Errorf("Decode err: %v", err)
    }
    break
}
```

## 或条件

```go
filter := bson.M{
    "$or": []bson.M{
        {"From_Account": from,
            "To_Account": to},
        {"From_Account": to,
            "To_Account": from},
    },
}
```

