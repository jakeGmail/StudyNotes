# 1 外键
MySQL 外键可以用于建立表与表之间的关联，实现表之间的数据完整性和约束：确保从表中的外键值在主表中有对应的值，同时在主表中修改或删除数据时，保持主表和从表的数据一致性。

外键的主要作用如下：

1. 数据完整性约束：外键保证了删除或更新主表记录时，从表中的外键约束也会被自动删除或更新，避免了数据不一致和数据冗余的问题。

2. 数据一致性保证：外键保证在关联表之间的数据完整性，防止数据引用不可用，确保数据的一致性和准确性，提高数据库系统的可靠性和稳定性。

3. 提升查询效率：外键建立了表与表之间的联系，可以优化关联表的查询效率，避免单纯大量重复数据的存储，能够提高数据的访问速度，减少数据检索的顺序扫描。

值得注意的是，虽然外键可以加强数据完整性和数据一致性，但是过多和不恰当的使用外键也会对性能和维护产生负面影响。外键约束会增加数据更新和删除的成本，降低数据的处理效率，同时在表的操作和维护中，需要考虑到外键之间的层层嵌套、不同约束之间的排斥和冲突等问题。因此，在使用外键时需要考虑到这些因素，权衡其优缺点，合理地设计和使用外键。

# 2 添加外键
## 2.1 创建表时添加外键
1. 首先，在需要添加外键的数据表中，创建需要关联的字段。例如：假设要在表A中添加外键，关联到表B的主键为 `id` 的字段上，可以在表A中添加一个名为 `b_id` 的字段，并指定其数据类型与表B中的主键 `id` 相同。

2. 然后，在创建表A的时候，需要在表A中的 `b_id` 字段上建立一个外键约束。在创建表A的时候，可以使用以下语句创建表A，并添加外键约束：

```sql
CREATE TABLE table_a (
    id INT AUTO_INCREMENT PRIMARY KEY,
    b_id INT NOT NULL,
    other_columns...
    CONSTRAINT fk_b_id FOREIGN KEY (b_id) REFERENCES table_b(id)
);
```

在该语句中，`fk_b_id` 是外键约束的名称，`FOREIGN KEY (b_id)` 表示设置 `b_id` 字段为外键，`REFERENCES table_b(id)` 则表示将该外键关联到表B中的 `id` 主键上。

3. 最后，在创建表B的时候，需要设置主键，因为外键必须关联到主键。例如，可以使用以下语句创建表B：

```sql
CREATE TABLE table_b (
    id INT AUTO_INCREMENT PRIMARY KEY,
    other_columns...
);
```

在该语句中，`id` 字段被设置为主键。

通过以上三个步骤，就可以在表A中添加外键约束，并将其关联到表B的主键上。需要注意的是，在添加外键之前，请确保已经创建了要关联的表和字段，并且确保外键约束关联的字段类型和属性完全匹配。另外，需要在关联表和字段上添加适当的索引，以确保外键的效率和性能。

**注意**：
- 如果一个表`A`中和的字段`b_id`被声明成`B`表的`id`字段的外键，那么向表A插入数据时，必须保证插入`A`表的数据中的`b_id`字段的值在B表中已存在，否则会插入失败。

## 2.2 对已存在的表添加外键
在 SQL 中，可以使用 `ALTER TABLE` 语句来添加外键约束。下面是创建外键约束的 SQL 语句的基本形式：

```sql
ALTER TABLE 表名
ADD CONSTRAINT 约束名称
FOREIGN KEY (外键字段) REFERENCES 关联表(主键字段) [ON DELETE 参照操作] [ON UPDATE 参照操作]
```

其中，`表名` 指需要添加外键约束的表， `约束名称` 是该外键约束的名称，用于标识该约束，可以为空；`外键字段` 是添加外键约束的字段，在当前表中将会作为外键使用；`关联表` 是外键关联的表，`主键字段` 是外键所关联的主键字段名称；`ON DELETE` 和 `ON UPDATE` 是参照操作，用于定义在主表更新或删除时如何处理外键约束。

以下是一些示例：

1. 添加不带参照操作的外键约束

创建外键约束时，可以不添加参照操作，MySQL 默认为 `RESTRICT`。

```sql
ALTER TABLE 表A
ADD CONSTRAINT FK_表A_表B  -- 这是外键名称
FOREIGN KEY (b_id)
REFERENCES 表B(id);
```

2. 添加带参照操作的外键约束

在指定外键和主键之间创建外键约束时，可以指定参照操作，在关联记录被更新或者删除时，参照操作定义了如何处理关联记录。

常见的<font color=red>参照操作</font>包括：

- `CASCADE`：表示级联删除或更新相关行；
- `SET NULL`：表示在父记录被删除后，子记录中的外键值设为 `NULL`；
- `SET DEFAULT`：表示在父记录被删除后，子记录中的外键值设为默认值；
- `RESTRICT`：表示禁止删除或更新关联表中的记录。

以下是带参照操作的外键约束的示例：

```sql
-- 删除主表中的记录时，级联删除从表中的记录
ALTER TABLE 表A
ADD CONSTRAINT FK_表A_表B
FOREIGN KEY (b_id)
REFERENCES 表B(id)
ON DELETE CASCADE;

-- 更新主表中的记录时，级联更新从表中的记录
ALTER TABLE 表A
ADD CONSTRAINT FK_表A_表B
FOREIGN KEY (b_id)
REFERENCES 表B(id)
ON UPDATE CASCADE;

-- 在主表中删除记录时，设置从表中的外键字段为 NULL
ALTER TABLE 表A
ADD CONSTRAINT FK_表A_表B
FOREIGN KEY (b_id)
REFERENCES 表B(id)
ON DELETE SET NULL;
```

需要注意的是，外键约束在建立之前需要在表中添加一个索引，以实现表之间的快速查询。因此，在添加外键约束之前，需要确保表所需的索引已经建立。同时，在使用外键约束时也要遵循引入约束后的完整性验证：一些校验需要外键引用的关联表确保数据的正确性。

# 2.3 删除外键约束
```
alter table 表名 drop foreign key 外键（区分大小写）;
```
示例：

```mysql
alter table `person` drop foreign key `fk_book_id`;
```